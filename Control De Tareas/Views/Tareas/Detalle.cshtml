@model Control_De_Tareas.Data.Entitys.Tareas
@{
    ViewData["Title"] = "Detalle de Tarea";
    var submission = ViewBag.Submission as Control_De_Tareas.Data.Entitys.Submissions;
    var totalEntregas = ViewBag.TotalEntregas as int?;
    var entregasCalificadas = ViewBag.EntregasCalificadas as int?;
}

<h2>@Model.Title</h2>

<p><strong>Curso:</strong> @Model.CourseOffering?.Course?.Title</p>
<p><strong>Descripción:</strong> @Model.Description</p>
<p><strong>Fecha límite:</strong> @Model.DueDate.ToLocalTime().ToString("g")</p>
<p><strong>Puntos máximos:</strong> @Model.MaxScore</p>

<hr />

@if (User.IsInRole("Estudiante"))
{
    <h4>Mi entrega</h4>

    @if (submission == null)
    {
        <p class="text-warning">No has entregado esta tarea aún.</p>
        <a asp-controller="Submissions" asp-action="Create" asp-route-assignmentId="@Model.Id"
           class="btn btn-success">Entregar tarea</a>
    }
    else
    {
        <p><strong>Fecha de entrega:</strong> @submission.SubmittedAt.ToLocalTime().ToString("g")</p>

        @if (submission.CurrentGrade.HasValue)
        {
            <p><strong>Calificación:</strong> @submission.CurrentGrade / @Model.MaxScore</p>
        }
        else
        {
            <p><strong>Estado:</strong> Entregada (pendiente de calificar)</p>
        }
    }
}

@if (User.IsInRole("Profesor"))
{
    <h4>Estadísticas para Profesor</h4>
    <p><strong>Total de entregas:</strong> @(totalEntregas ?? 0)</p>
    <p><strong>Entregas calificadas:</strong> @(entregasCalificadas ?? 0)</p>

    <a asp-controller="Submissions" asp-action="Index" asp-route-taskId="@Model.Id"
       class="btn btn-info">Ver todas las entregas</a>
    <a asp-action="Editar" asp-route-id="@Model.Id" class="btn btn-primary">Editar Tarea</a>
}

@if (User.IsInRole("Administrador"))
{
    <a asp-action="Editar" asp-route-id="@Model.Id" class="btn btn-primary">Editar</a>
    <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-danger">Eliminar</a>
}