@using Control_De_Tareas.Models
@using Control_De_Tareas.Services
@inject IHttpContextAccessor HttpContextAccessor

@{
    // Determinar rol del usuario
    var userRole = "guest";
    if (User.Identity?.IsAuthenticated == true)
    {
        if (User.IsInRole("Administrador")) userRole = "admin";
        else if (User.IsInRole("Profesor")) userRole = "profesor";
        else if (User.IsInRole("Estudiante")) userRole = "estudiante";
    }

    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    var userItems = MenuServices.Items.Where(m => m.Roles.Contains(userRole)).ToList();
}

<aside class="sidebar" id="simpleSidebar">
    <nav class="p-3">
        <button onclick="toggleSidebar()" class="btn btn-sm btn-outline-secondary">
            <i class="fas fa-bars"></i>
        </button>
        <ul class="nav flex-column">
            @foreach (var item in userItems)
            {
                var isActive = item.Controller == currentController;
                <li class="nav-item mb-1">
                    <a asp-controller="@item.Controller"
                       asp-action="@item.Action"
                       class="nav-link d-flex align-items-center text-black @(isActive ? "active" : "")"
                       style="padding: 0.75rem 1rem; border-left: 3px solid transparent; @(isActive ? "border-left-color: rgba(11, 93, 157, 0.8); background-color: rgba(255,255,255,0.1);" : "")">
                        <span class="icon-wrapper me-2">
                            <i data-lucide="@item.Icon" width="18" height="18"></i>
                        </span>
                        <span class="menu-text">@item.Label</span>
                    </a>
                </li>
            }
        </ul>
    </nav>
</aside>

<style>
    .sidebar {
        width: 250px;
        transition: width 0.3s;
        position: fixed;
        height: 100vh;
        background-color: #f8f9fa;
        z-index: 1000;
        top: 56px; /* Altura del navbar */
    }

        .sidebar.collapsed {
            width: 60px;
        }

            .sidebar.collapsed .menu-text {
                display: none;
            }

    .nav-link.active {
        background-color: rgba(13, 110, 253, 0.1) !important;
        border-left-color: #0d6efd !important;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    });

    function toggleSidebar() {
        const sidebar = document.getElementById('simpleSidebar');
        const mainContent = document.querySelector('main[role="main"]');

        if (sidebar && mainContent) {
            sidebar.classList.toggle('collapsed');
            if (sidebar.classList.contains('collapsed')) {
                mainContent.style.marginLeft = '60px';
            } else {
                mainContent.style.marginLeft = '250px';
            }
        }
    }
</script>