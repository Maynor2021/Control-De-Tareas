@model IEnumerable<Control_De_Tareas.Data.Entitys.Tareas>
@{
    ViewData["Title"] = "Lista de Tareas";
    var course = ViewBag.CourseOffering as Control_De_Tareas.Data.Entitys.CourseOfferings;
    var userRole = ViewBag.UserRole as string;
    var userName = ViewBag.UserName as string;
    var isProfessor = userRole == "Profesor";
    var isAdmin = userRole == "Administrador";
}

<h2>@(course != null ? "Tareas - " + (course.Course?.Description ?? "Curso") : "Tareas")</h2>

@if (isProfessor)
{
    <div class="alert alert-info mb-3">
        <i class="bi bi-info-circle"></i>
        <strong>Vista de profesor</strong>
        <p class="mb-0">Solo puedes ver y gestionar tareas de los cursos que impartes.</p>
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle"></i>
        @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle"></i>
        @TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (Model.Any())
{
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Curso</th>
                <th>Título</th>
                <th>Fecha límite</th>
                <th>Puntos</th>
                <th>Profesor</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var t in Model)
            {
                <tr>
                    <td>@(t.CourseOffering?.Course?.Description ?? "-")</td>
                    <td>@t.Title</td>
                    <td>@t.DueDate.ToLocalTime().ToString("g")</td>
                    <td>@t.MaxScore</td>
                    <td>@t.CreatedByUser?.UserName</td>
                    <td>
                        <a asp-action="Detalle" asp-route-id="@t.Id" class="btn btn-sm btn-outline-primary">Ver</a>
                        @if (isProfessor || isAdmin)
                        {
                            <a asp-action="Editar" asp-route-id="@t.Id" class="btn btn-sm btn-outline-secondary">Editar</a>
                            <form asp-action="Delete" asp-controller="Tareas" method="post" style="display: inline;">
                                <input type="hidden" name="id" value="@t.Id" />
                                @Html.AntiForgeryToken()
                                <button type="submit"
                                        class="btn btn-sm btn-outline-danger"
                                        onclick="return confirm('¿Está seguro de eliminar esta tarea?\n\nTítulo: @t.Title\nCurso: @t.CourseOffering?.Course?.Title')">
                                    Eliminar
                                </button>
                            </form>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <div class="text-center py-5">
        <i class="bi bi-inbox display-1 text-muted"></i>
        <h4 class="mt-3 text-muted">No hay tareas registradas</h4>
        @if (isProfessor)
        {
            <p class="text-muted">Comienza creando tu primera tarea en uno de los cursos que impartes.</p>
            <a asp-action="Crear" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Crear Tarea
            </a>
        }
        else
        {
            <p class="text-muted">No hay tareas disponibles.</p>
        }
    </div>
}